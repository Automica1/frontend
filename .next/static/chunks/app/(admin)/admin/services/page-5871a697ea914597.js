(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4600],{36284:(e,t,s)=>{Promise.resolve().then(s.bind(s,38929))},38929:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var a=s(72311),r=s(62847),l=s(60414),i=s(56724),c=s(1532),n=s(36183),d=s(99027),o=s(42309),x=s(16993),m=s(39965),h=s(56239),u=s(9496),g=s(52809),p=s(8105),y=s(53347),j=s(15587),b=s(47190),f=s(89447),N=s(7346),v=s(40553),w=s(8900),k=s(45836),_=s(33301),S=s(51787),A=s(43074),C=s(12086),T=s(51252),U=s(59390);let D=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316"],R=()=>{var e,t,s,R,E;let[L,F]=(0,r.useState)(null),[K,q]=(0,r.useState)(!0),[P,M]=(0,r.useState)("overview"),[Q,B]=(0,r.useState)("allTime"),[O,I]=(0,r.useState)(""),[H,Y]=(0,r.useState)(null),[z,G]=(0,r.useState)(!1),[V,W]=(0,r.useState)(""),[J,Z]=(0,r.useState)(null),[$,X]=(0,r.useState)(0),ee=U.K.getDateRangePresets();(0,r.useEffect)(()=>{et()},[Q]);let et=async()=>{try{q(!0),Z(null);let e={};"allTime"!==Q&&ee[Q]&&(e.start_date=ee[Q].start_date,e.end_date=ee[Q].end_date);let t=await U.K.getUsageAnalytics(e);F(t),X(0)}catch(t){let e=t instanceof Error?t.message:"An unknown error occurred";Z(e),console.error("Error fetching analytics:",t),$<3&&e.includes("Authentication")&&setTimeout(()=>{X(e=>e+1),et()},1e3*($+1))}finally{q(!1)}},es=async e=>{if(e)try{G(!0);let t={limit:50,skip:0};"allTime"!==Q&&ee[Q]&&(t.start_date=ee[Q].start_date,t.end_date=ee[Q].end_date);let s=await U.K.getServiceUsageHistory(e,t);Y(s)}catch(e){e instanceof Error&&e.message,console.error("Error fetching service history:",e)}finally{G(!1)}};(0,r.useEffect)(()=>{O?es(O):Y(null)},[O,Q]);let ea=e=>{I(e),M("history")},er=e=>{switch(e.toLowerCase()){case"bearer_token":case"api_key":return(0,a.jsx)(p.A,{className:"h-3 w-3"});case"browser":case"session":return(0,a.jsx)(y.A,{className:"h-3 w-3"});default:return(0,a.jsx)(j.A,{className:"h-3 w-3"})}},el=e=>{switch(e.toLowerCase()){case"bearer_token":return"API Key";case"browser":case"session":return"Browser";default:return e.charAt(0).toUpperCase()+e.slice(1)}},ei=e=>{switch(e.toLowerCase()){case"bearer_token":case"api_key":return"bg-blue-100 text-blue-800";case"browser":case"session":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};if(K&&!L)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(b.A,{className:"h-6 w-6 animate-spin text-blue-600"}),(0,a.jsx)("span",{className:"text-lg",children:"Loading analytics..."})]})});if(J&&!L)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(f.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Analytics"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:J}),(0,a.jsxs)("div",{className:"space-x-3",children:[(0,a.jsxs)("button",{onClick:et,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 inline-flex items-center",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Retry"]}),$>0&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["Retry attempt: ",$,"/3"]})]})]})});if(!L)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(j.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No analytics data available"})]})});let ec=(null==(e=L.globalStats)?void 0:e.stats)||[],en=(null==(t=L.userStats)?void 0:t.stats)||[],ed=(null==(s=L.globalStats)?void 0:s.total_services)||0,eo=(null==(R=L.userStats)?void 0:R.total_users)||0,ex=ec.reduce((e,t)=>({totalCalls:e.totalCalls+t.total_calls,successCalls:e.successCalls+t.success_calls,failedCalls:e.failedCalls+t.failed_calls,totalCredits:e.totalCredits+t.total_credits}),{totalCalls:0,successCalls:0,failedCalls:0,totalCredits:0}),em=U.K.calculateSuccessRate(ex.successCalls,ex.totalCalls),eh=ec.map(e=>({name:U.K.formatServiceName(e.service_name),calls:e.total_calls,success:e.success_calls,failed:e.failed_calls,credits:e.total_credits,successRate:U.K.calculateSuccessRate(e.success_calls,e.total_calls)})),eu=ec.map((e,t)=>({name:U.K.formatServiceName(e.service_name),value:e.total_calls,color:D[t%D.length]})),eg=(null==H||null==(E=H.usage_history)?void 0:E.filter(e=>!V||e.email.toLowerCase().includes(V.toLowerCase())||e.endpoint.toLowerCase().includes(V.toLowerCase())||e.method.toLowerCase().includes(V.toLowerCase())||el(e.auth_method).toLowerCase().includes(V.toLowerCase())))||[],ep=0===ec.length;return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Usage Analytics"}),(0,a.jsx)("p",{className:"text-gray-600 mb-2",children:"Monitor service usage, performance, and user activity"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Period: ",(()=>{var e,t,s,a;if("allTime"===Q)return"All Time";if((null==(t=L.globalStats)||null==(e=t.date_range)?void 0:e.start_date)&&(null==(a=L.globalStats)||null==(s=a.date_range)?void 0:s.end_date)){let e=U.K.formatDate(L.globalStats.date_range.start_date),t=U.K.formatDate(L.globalStats.date_range.end_date);return"".concat(e," - ").concat(t)}return Q.charAt(0).toUpperCase()+Q.slice(1)})()]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("select",{value:Q,onChange:e=>B(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"allTime",children:"All Time"}),(0,a.jsx)("option",{value:"today",children:"Today"}),(0,a.jsx)("option",{value:"yesterday",children:"Yesterday"}),(0,a.jsx)("option",{value:"last7Days",children:"Last 7 Days"}),(0,a.jsx)("option",{value:"last30Days",children:"Last 30 Days"}),(0,a.jsx)("option",{value:"thisMonth",children:"This Month"}),(0,a.jsx)("option",{value:"lastMonth",children:"Last Month"})]}),(0,a.jsxs)("button",{onClick:()=>{if(!L||!L.globalStats.stats)return;let e=new Blob([[["Service","Total Calls","Success Calls","Failed Calls","Success Rate (%)","Credits Used"],...L.globalStats.stats.map(e=>({service:U.K.formatServiceName(e.service_name),total_calls:e.total_calls,success_calls:e.success_calls,failed_calls:e.failed_calls,success_rate:U.K.calculateSuccessRate(e.success_calls,e.total_calls),total_credits:e.total_credits})).map(e=>[e.service,e.total_calls,e.success_calls,e.failed_calls,e.success_rate,e.total_credits])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="usage-analytics-".concat(Q,"-").concat(new Date().toISOString().split("T")[0],".csv"),s.click(),window.URL.revokeObjectURL(t)},disabled:ep,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center text-sm",children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),(0,a.jsxs)("button",{onClick:et,disabled:K,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center text-sm",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2 ".concat(K?"animate-spin":"")}),"Refresh"]})]})]})}),J&&L&&(0,a.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-700",children:["Warning: ",J,". Showing cached data."]})})})}),ep&&(0,a.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(v.A,{className:"h-5 w-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"No Data Available"}),(0,a.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"No usage data found for the selected period. This might be because:"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-700 mt-2 list-disc list-inside",children:[(0,a.jsx)("li",{children:"The API tracking was implemented recently and doesn't have historical data"}),(0,a.jsx)("li",{children:"No API calls were made during this time period"}),(0,a.jsx)("li",{children:"The selected date range is before data collection began"})]}),(0,a.jsx)("p",{className:"text-sm text-blue-700 mt-2",children:'Try selecting "All Time" or a more recent date range to see available data.'})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total API Calls"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:ex.totalCalls.toLocaleString()}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[ex.successCalls," success, ",ex.failedCalls," failed"]})]}),(0,a.jsx)(j.A,{className:"h-8 w-8 text-blue-600"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[em,"%"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:ex.totalCalls>0?"Based on all requests":"No data available"})]}),(0,a.jsx)(w.A,{className:"h-8 w-8 text-green-600"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Credits Used"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:ex.totalCredits.toLocaleString()}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Across all services"})]}),(0,a.jsx)(k.A,{className:"h-8 w-8 text-purple-600"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Services"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:ed}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[eo," active users"]})]}),(0,a.jsx)(_.A,{className:"h-8 w-8 text-orange-600"})]})})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("nav",{className:"flex space-x-8 border-b border-gray-200",children:[{id:"overview",label:"Overview"},{id:"services",label:"Services"},{id:"users",label:"Users"},{id:"history",label:"Usage History"}].map(e=>(0,a.jsx)("button",{onClick:()=>M(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm transition-colors ".concat(P===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"overview"===P&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Service Usage Overview"}),eh.length>0?(0,a.jsx)(l.u,{width:"100%",height:300,children:(0,a.jsxs)(i.E,{data:eh,children:[(0,a.jsx)(c.d,{strokeDasharray:"3 3"}),(0,a.jsx)(n.W,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12,interval:0}),(0,a.jsx)(d.h,{}),(0,a.jsx)(o.m,{}),(0,a.jsx)(x.s,{}),(0,a.jsx)(m.y,{dataKey:"calls",fill:"#3B82F6",name:"Total Calls"}),(0,a.jsx)(m.y,{dataKey:"credits",fill:"#10B981",name:"Credits Used"})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(j.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No usage data available for the selected period"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Try selecting a different date range"})]})})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Usage Distribution"}),eu.length>0?(0,a.jsx)(l.u,{width:"100%",height:300,children:(0,a.jsxs)(h.r,{children:[(0,a.jsx)(u.F,{data:eu,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percent:s}=e;return"".concat(t," ").concat(((null!=s?s:0)*100).toFixed(0),"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:eu.map((e,t)=>(0,a.jsx)(g.f,{fill:e.color},"cell-".concat(t)))}),(0,a.jsx)(o.m,{})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(j.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No usage data available for the selected period"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Try selecting a different date range"})]})})]})]}),"services"===P&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Service Performance"})}),ec.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Service"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Calls"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Success Rate"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits Used"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:ec.map((e,t)=>{let s=U.K.calculateSuccessRate(e.success_calls,e.total_calls);return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:U.K.formatServiceName(e.service_name)}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.service_name})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.total_calls.toLocaleString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(100===s?"bg-green-100 text-green-800":s>=95?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[s,"%"]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.total_credits.toLocaleString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("button",{onClick:()=>ea(e.service_name),className:"text-blue-600 hover:text-blue-900 flex items-center transition-colors",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"View History"]})})]},t)})})]})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(_.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No service data available for the selected period"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Try selecting a different date range or check back later"})]})]}),"users"===P&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"User Activity"})}),en.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Calls"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Success Rate"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits Used"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:en.map((e,t)=>{let s=U.K.calculateSuccessRate(e.success_calls,e.total_calls);return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.email}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.user_id})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.total_calls.toLocaleString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[s,"%"]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.total_credits.toLocaleString()})]},t)})})]})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(A.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No user activity data available for the selected period"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Try selecting a different date range or check back later"})]})]}),"history"===P&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Usage History ",O&&"- ".concat(U.K.formatServiceName(O))]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(C.A,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search history...",value:V,onChange:e=>W(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("select",{value:O,onChange:e=>I(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Select Service"}),ec.map(e=>(0,a.jsx)("option",{value:e.service_name,children:U.K.formatServiceName(e.service_name)},e.service_name))]})]})]})}),z?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(b.A,{className:"h-6 w-6 animate-spin text-blue-600 mr-3"}),(0,a.jsx)("span",{children:"Loading history..."})]}):O&&H?(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Endpoint"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Auth Method"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Response Time"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:eg.length>0?eg.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsx)("div",{className:"font-medium",children:U.K.formatDate(e.created_at)})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.email}),(0,a.jsx)("div",{className:"text-sm text-gray-500 truncate max-w-32",title:e.user_id,children:e.user_id})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.endpoint}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.method})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(ei(e.auth_method)),children:[er(e.auth_method),(0,a.jsx)("span",{className:"ml-1",children:el(e.auth_method)})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[e.success?(0,a.jsx)(w.A,{className:"h-3 w-3 mr-1"}):(0,a.jsx)(f.A,{className:"h-3 w-3 mr-1"}),e.success?"Success":"Failed"]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.credits_used}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsxs)("span",{className:"".concat(e.process_time_ms>5e3?"text-red-600":e.process_time_ms>2e3?"text-yellow-600":"text-green-600"),children:[e.process_time_ms,"ms"]})})]},e.id)):(0,a.jsx)("tr",{children:(0,a.jsxs)("td",{colSpan:7,className:"px-6 py-12 text-center",children:[(0,a.jsx)(T.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:V?"No records match your search criteria":"No usage history available for this service"}),!V&&O&&(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"This might be because the service hasn't been used in the selected time period"})]})})})]}),H&&H.usage_history&&H.usage_history.length>0&&(0,a.jsx)("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:["Showing ",H.pagination.skip+1," to "," ",Math.min(H.pagination.skip+H.pagination.limit,H.total_records)," of"," ",H.total_records," records"]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{H.pagination.skip>0&&console.log("Previous page")},disabled:0===H.pagination.skip,className:"px-3 py-1 border border-gray-300 rounded text-xs disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>{H.pagination.skip+H.pagination.limit<H.total_records&&console.log("Next page")},disabled:H.pagination.skip+H.pagination.limit>=H.total_records,className:"px-3 py-1 border border-gray-300 rounded text-xs disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:"Next"})]})]})})]}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(j.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500",children:0===ec.length?"No services available for the selected period":"Select a service to view its usage history"}),0===ec.length&&(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:'Try selecting "All Time" or a different date range to see available services'})]})]})]})]})})}},59390:(e,t,s)=>{"use strict";s.d(t,{K:()=>r});class a{async getAuthToken(){if(this.authToken&&this.tokenExpiry&&Date.now()<this.tokenExpiry-3e5)return this.authToken;try{let e=await fetch("/api/auth",{credentials:"include"});if(!e.ok)throw Error("Auth failed: ".concat(e.status));let{accessToken:t,expiresIn:s}=await e.json();return this.authToken=t,this.tokenExpiry=Date.now()+1e3*s,t}catch(e){throw this.clearAuth(),Error("Authentication failed. Please log in again.")}}clearAuth(){this.authToken=null,this.tokenExpiry=null}buildQueryString(e){let t=Object.entries(e).filter(e=>{let[t,s]=e;return null!=s&&""!==s});if(0===t.length)return"";let s=t.map(e=>{let[t,s]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(s))}).join("&");return"?".concat(s)}async makeAuthenticatedRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=await this.getAuthToken(),a=await fetch("".concat(this.baseUrl).concat(e),{...t,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s),...t.headers}});if(!a.ok){if(401===a.status)throw this.clearAuth(),Error("Authentication expired. Please log in again.");let e=await a.text();throw Error("API Error (".concat(a.status,"): ").concat(e))}return a.json()}async generateToken(e,t){return this.makeAuthenticatedRequest("/tokens/generate",{method:"POST",body:JSON.stringify({credits:e,description:t})})}async deleteToken(e){return this.makeAuthenticatedRequest("/tokens/".concat(e),{method:"DELETE"})}async getMyTokens(){return this.makeAuthenticatedRequest("/tokens/my-tokens")}async getAllTokens(){return this.makeAuthenticatedRequest("/tokens/all")}async getUsedTokens(){return this.makeAuthenticatedRequest("/tokens/used")}async getUnusedTokens(){return this.makeAuthenticatedRequest("/tokens/unused")}async getAllUsers(){return this.makeAuthenticatedRequest("/admin/users")}async getUserById(e){return this.makeAuthenticatedRequest("/admin/users/".concat(e))}async getUserStats(){return this.makeAuthenticatedRequest("/admin/users/stats")}async getUserActivity(e){return this.makeAuthenticatedRequest("/admin/users/".concat(e,"/activity"))}async getUserCredits(e){return this.makeAuthenticatedRequest("/admin/users/".concat(e,"/credits"))}async getGlobalUsageStats(e){let t=e?this.buildQueryString(e):"";return this.makeAuthenticatedRequest("/admin/usage/global".concat(t))}async getUserUsageStats(e){let t=e?this.buildQueryString(e):"";return this.makeAuthenticatedRequest("/admin/usage/users".concat(t))}async getServiceUserStats(e){let t=e?this.buildQueryString(e):"";return this.makeAuthenticatedRequest("/admin/usage/services".concat(t))}async getUserUsageHistory(e,t){let s=t?this.buildQueryString(t):"";return this.makeAuthenticatedRequest("/admin/usage/user/".concat(e,"/history").concat(s))}async getServiceUsageHistory(e,t){let s=t?this.buildQueryString(t):"";return this.makeAuthenticatedRequest("/admin/usage/service/".concat(e,"/history").concat(s))}isAuthenticated(){return!!(this.authToken&&this.tokenExpiry&&Date.now()<this.tokenExpiry)}getTokenExpiry(){return this.tokenExpiry}refreshAuth(){this.clearAuth()}async getTokenStats(){try{let[e,t,s,a]=await Promise.all([this.getAllTokens(),this.getUsedTokens(),this.getUnusedTokens(),this.getMyTokens()]);return{total:e.count||e.tokens.length,used:t.count||t.tokens.length,unused:s.count||s.tokens.length,myTokens:a.count||a.tokens.length}}catch(e){throw Error("Failed to fetch token statistics: ".concat(e))}}async getDashboardStats(){try{let[e,t]=await Promise.all([this.getTokenStats(),this.getUserStats()]);return{tokenStats:e,userStats:t.stats}}catch(e){throw Error("Failed to fetch dashboard statistics: ".concat(e))}}async getUsageAnalytics(e){try{let[t,s,a]=await Promise.all([this.getGlobalUsageStats(e),this.getUserUsageStats(e),this.getServiceUserStats(e)]);return{globalStats:t,userStats:s,serviceStats:a}}catch(e){throw Error("Failed to fetch usage analytics: ".concat(e))}}async getTopServicesByUsage(e){try{return(await this.getGlobalUsageStats(e)).stats.sort((e,t)=>t.total_calls-e.total_calls)}catch(e){throw Error("Failed to fetch top services: ".concat(e))}}async getTopUsersByUsage(e){try{return(await this.getUserUsageStats(e)).stats.sort((e,t)=>t.total_calls-e.total_calls)}catch(e){throw Error("Failed to fetch top users: ".concat(e))}}isValidTokenFormat(e){return/^TK_[a-zA-Z0-9]{33}$/.test(e)}formatTokenForDisplay(e){return!e||e.length<10?e:"".concat(e.substring(0,8),"...").concat(e.substring(e.length-6))}getDaysUntilExpiry(e){let t=new Date(e),s=new Date;return Math.ceil((t.getTime()-s.getTime())/864e5)}isTokenExpired(e){return new Date(e)<new Date}formatUserRole(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}isUserRecentlyActive(e){return!!e&&new Date(e)>new Date(Date.now()-2592e6)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatDateForQuery(e){return e.toISOString().split("T")[0]}calculateSuccessRate(e,t){return 0===t?0:Math.round(e/t*1e4)/100}formatServiceName(e){return e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}getDateRangePresets(){let e=new Date,t=this.formatDateForQuery(e),s=new Date(e);s.setDate(s.getDate()-1);let a=new Date(e);a.setDate(a.getDate()-7);let r=new Date(e);r.setDate(r.getDate()-30);let l=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()-1,1),c=new Date(e.getFullYear(),e.getMonth(),0);return{today:{start_date:t,end_date:t},yesterday:{start_date:this.formatDateForQuery(s),end_date:this.formatDateForQuery(s)},last7Days:{start_date:this.formatDateForQuery(a),end_date:t},last30Days:{start_date:this.formatDateForQuery(r),end_date:t},thisMonth:{start_date:this.formatDateForQuery(l),end_date:t},lastMonth:{start_date:this.formatDateForQuery(i),end_date:this.formatDateForQuery(c)}}}constructor(){this.authToken=null,this.tokenExpiry=null,this.baseUrl="https://automica.ai/go/api/v1"}}let r=new a}},e=>{var t=t=>e(e.s=t);e.O(0,[5180,5789,6020,7358],()=>t(36284)),_N_E=e.O()}]);